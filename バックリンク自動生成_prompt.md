# Obsidian バックリンク自動付与プロンプト

既存の `[[ファイル名]]` リンクを逆引きして、各ファイルの末尾にバックリンクセクションを自動追記する。

---

## エージェントへの指示

### 目的
Obsidianフォルダ内のすべての.mdファイルを対象に、バックリンクを各ファイルの末尾に自動追記する。

### 対象
- **パス**: `c:\Users\user\Desktop\obsidian`
- **対象**: `.md` ファイルのみ
- **除外**: `.obsidian` フォルダ（設定ファイル）

### 処理手順

1. **スキャン**: 対象フォルダ内のすべての `.md` ファイルを再帰的に取得する
   - **除外**: `.obsidian`、`src` などのシステム・コード系フォルダ

2. **リンクマップ構築**:
   - 全ファイルを読み込み、`[[リンク先]]` の記述をすべて収集する
   - **「誰が誰にリンクしているか」** の全容を把握し、逆引きマップ（被リンク一覧）を作成する

3. **バックリンク適用（冪等性の担保）**:
   - 各ファイルについて、以下の処理を行う：
     1. 既存の `## バックリンク` セクション（およびその下のリスト）を**正規表現で完全に削除**する
     2. 手順2で作成した逆引きマップに基づき、自分にリンクしているファイルの一覧を作成する
     3. **もし被リンクが存在すれば**、ファイルの末尾に `## バックリンク` セクションを新規作成し、リストを追記する
     4. 被リンクがない場合は、セクションを作成しない（または既存を削除したままにする）

### 出力形式（ファイル追記イメージ）

```markdown
（本文の最後）
...これで完了です。

---
## バックリンク
- [[参照元ファイルA]]
- [[参照元ファイルB]]
```

### 重要なルール

1. **上書き更新**: 既存のバックリンク記述は古くなっている可能性があるため、必ず一度削除して最新状態で再生成すること。
2. **手動記述の保護**: `## バックリンク` セクション以外の場所（文中など）にある `[[リンク]]` は絶対に削除・変更しないこと。
3. **安全確認**: 実行前に変更対象ファイル数と変更内容のサマリ（ドライラン結果）をユーザーに提示すること。

---

## 使用例

### Before: AI文章バレ対策.md
```markdown
# AI文章バレ対策
...内容...
[[nanobanana.md]]
```

### After: nanobanana.md
```markdown
# Nanobanana
...内容...

---
## バックリンク
- [[AI文章バレ対策]]
```

---

## 定期実行

- 週1回、または新規ノートを大量追加した後に実行を推奨
- 変更がなければスキップする仕組みを入れると効率的
